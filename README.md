# OptiMoVe: Оптимизация движения
Дипломная работа: Моделирование движения городского пассажирского транспорта

### Полное техническое задание представлено в каталоге `info` в файле `Дипломная работа.docx`

### Используемые технологии при создании программного средства:
* Язык программирования: `Python`
* `Django`
* `JavaScript`
* `JQuery`
* `Bootstrap`

### URLS

http://127.0.0.1:82/
http://127.0.0.1:82/admin/
http://127.0.0.1:82/docs/

### Экранные формы программного средства представлены ниже

>**Основное окно авторизованного пользователя**
>![Карта](info/scrin1.png)
>**Модальное окно выбора маршрута**
>*Данные получены по средствам ajax запросов*
>![*Выберите маршрут*](info/scrin2.png)

### Инструкция развёртывания

python 3.10.6
все зависимости находятся в файле req.txt

**Установка:**

***Docker***

-Установить на машину Docker

-Открыть в терминале папку web_map

-Прописать команду: docker compose -f 'build\docker-compose.yml' up -d --build

*Результат:*

>✔ Network web_map_default Created
>
>✔Container web_map-web-1 Started

-Перейти на http://127.0.0.1:82/
Начальный пользователь: admin/admin

*Остановка:*

>docker compose -f 'build\docker-compose.yml' --project-name 'web_map' down

***Без Docker (Подробная инструкция для Windows)***

#### Шаг 1: Установка Python

1. Перейдите на официальный сайт Python: https://www.python.org/downloads/
2. Скачайте Python версии 3.10.6 или выше (но не выше 3.11)
3. Запустите установщик и **обязательно** поставьте галочку "Add Python to PATH" внизу окна
4. Нажмите "Install Now"
5. После установки откройте командную строку (Win+R → введите `cmd` → Enter) и проверьте установку:
   ```
   python --version
   ```
   Должна отобразиться версия Python (например: Python 3.10.6)

#### Шаг 2: Установка PostgreSQL с расширением PostGIS

1. Скачайте PostgreSQL с официального сайта: https://www.postgresql.org/download/windows/
2. Запустите установщик PostgreSQL (рекомендуемая версия 14 или 15)
3. При установке:
   - Запомните пароль для пользователя `postgres` (он понадобится позже)
   - Порт оставьте по умолчанию: `5432`
   - В конце установки **обязательно** запустите Stack Builder для установки PostGIS
4. В Stack Builder:
   - Выберите вашу версию PostgreSQL
   - Разверните раздел "Spatial Extensions"
   - Установите галочку на "PostGIS Bundle"
   - Завершите установку PostGIS

#### Шаг 3: Установка OSGeo4W (для поддержки геопространственных данных)

1. Скачайте OSGeo4W: https://trac.osgeo.org/osgeo4w/
2. Запустите установщик OSGeo4W (osgeo4w-setup.exe)
3. Выберите "Express Install"
4. Установите следующие компоненты:
   - GDAL
   - GEOS
5. По умолчанию установка происходит в `C:\OSGeo4W\`

#### Шаг 4: Создание базы данных в PostgreSQL

1. Откройте pgAdmin (устанавливается вместе с PostgreSQL)
2. Подключитесь к серверу (введите пароль, который задали при установке)
3. Правой кнопкой мыши на "Databases" → "Create" → "Database"
4. Укажите имя базы данных: `OptiMoVe`
5. Нажмите "Save"
6. Откройте созданную базу данных → правой кнопкой на "Extensions" → "Create" → "Extension"
7. В поле "Name" выберите `postgis` и нажмите "Save"

#### Шаг 5: Подготовка проекта

1. Скачайте или клонируйте проект в папку, например: `C:\Projects\web_map`
2. Откройте командную строку в папке проекта:
   - Откройте папку проекта в Проводнике
   - В адресной строке введите `cmd` и нажмите Enter
3. Создайте виртуальное окружение:
   ```
   python -m venv venv
   ```
4. Активируйте виртуальное окружение:
   ```
   venv\Scripts\activate
   ```
   После активации в начале строки появится `(venv)`

#### Шаг 6: Установка зависимостей проекта

1. Убедитесь, что виртуальное окружение активировано (см. Шаг 5)
2. Обновите pip:
   ```
   python -m pip install --upgrade pip
   ```
3. Установите зависимости:
   ```
   pip install -r requirements.txt
   ```
   Установка может занять несколько минут

#### Шаг 7: Настройка подключения к базе данных

По умолчанию проект настроен на подключение к базе данных:
- Имя БД: `OptiMoVe`
- Пользователь: `postgres`
- Пароль: `postgres`
- Хост: `localhost`
- Порт: `5432`

**Если ваши настройки отличаются, выполните следующее:**

1. Скопируйте файл `.env.example` и переименуйте его в `.env`:
   - Откройте папку проекта в Проводнике
   - Найдите файл `.env.example`
   - Скопируйте его (Ctrl+C, затем Ctrl+V)
   - Переименуйте копию в `.env` (уберите `.example`)

2. Откройте файл `.env` в любом текстовом редакторе (например, Блокнот)

3. Измените значения под ваши настройки

4. Сохраните файл

#### Шаг 8: Применение миграций базы данных

1. Убедитесь, что виртуальное окружение активировано
2. Выполните команду:
   ```
   python manage.py migrate
   ```
   Вы увидите список применяемых миграций

#### Шаг 9: Создание администратора системы

1. Создайте суперпользователя:
   ```
   python manage.py createsuperuser
   ```
2. Введите желаемые данные:
   - Username (имя пользователя)
   - Email (можно оставить пустым, нажав Enter)
   - Password (пароль - при вводе не отображается)
   - Password (again) (повторите пароль)

#### Шаг 10: Загрузка данных (опционально)

Если нужно загрузить начальные данные о городах и остановках:
```
python manage.py add_citys
python manage.py load_stations
```

#### Шаг 11: Запуск сервера

1. Запустите тестовый сервер разработки:
   ```
   python manage.py runserver 82
   ```
2. Откройте браузер и перейдите по адресу: http://127.0.0.1:82/
3. Для входа в админ-панель: http://127.0.0.1:82/admin/

#### Остановка сервера

Для остановки сервера нажмите `Ctrl+C` в командной строке

#### Повторный запуск

При следующем запуске проекта:
1. Откройте командную строку в папке проекта
2. Активируйте виртуальное окружение: `venv\Scripts\activate`
3. Запустите сервер: `python manage.py runserver`

#### Возможные проблемы и решения

**Проблема:** Ошибка "python не является внутренней командой"
- **Решение:** Python не добавлен в PATH. Переустановите Python с галочкой "Add Python to PATH"

**Проблема:** Ошибка при установке psycopg2-binary
- **Решение:** Установите Microsoft Visual C++ Redistributable: https://aka.ms/vs/17/release/vc_redist.x64.exe

**Проблема:** Ошибка "Could not find the GDAL library"
- **Решение:** Проверьте установку OSGeo4W и правильность путей в переменных окружения

**Проблема:** Ошибка подключения к PostgreSQL
- **Решение:** Убедитесь, что служба PostgreSQL запущена (Службы Windows → postgresql)

**Проблема:** Ошибка "No module named 'dotenv'"
- **Решение:** Если используете .env файл, установите: `pip install python-dotenv`
